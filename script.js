var DECADES = [
  {
    id:'1970s',
    items:[
      {year:'1975',desc:'On July 24, Giorgio Armani founds his brand in Milan, together with Sergio Galeotti. It is the beginning of a stylistic revolution destined to redefine the way we conceive clothing. Characterized by a sober yet innovative language, Armani inaugurates a \u201Ctimeless\u201D aesthetic\u2014rooted in tailoring precision, the simplification of forms, and the idea of clothing as a natural extension of personality, beyond seasons and fleeting trends.',credit:'Giorgio Armani logo, designed by Flavio Lucchini, used on labels from 1976 to the mid-1980s',img:'https://picsum.photos/seed/a70a/800/1000'},
      {year:'1976',desc:'The first Giorgio Armani womenswear collection is presented in Milan. The deconstructed jacket becomes the defining silhouette, freeing the female body from rigid tailoring conventions while maintaining an unmistakable sense of elegance.',credit:'Giorgio Armani womenswear debut, Milan, 1976',img:'https://picsum.photos/seed/a70b/800/1000'},
      {year:'1977',desc:'Armani expands the brand with the launch of a ready-to-wear line, bringing the philosophy of understated luxury to a wider audience. The interplay of neutral tones and fluid fabrics defines the emerging aesthetic language.',credit:'Armani ready-to-wear presentation, Milan Fashion Week, 1977',img:'https://picsum.photos/seed/a70c/800/1000'},
      {year:'1978',desc:'The brand introduces a fragrance line, extending the Armani vision beyond clothing into the realm of personal expression. Every detail reflects the same principles of refined simplicity.',credit:'Armani fragrance campaign, 1978',img:'https://picsum.photos/seed/a70d/800/1000'},
      {year:'1979',desc:'International press begins to take notice of the Italian designer who is rewriting the rules of modern dressing. The clean lines and muted palettes become synonymous with a new definition of power and poise.',credit:'International fashion press coverage, 1979',img:'https://picsum.photos/seed/a70e/800/1000'},
      {year:'1979',desc:'Giorgio Armani receives his first Neiman Marcus Fashion Award, marking the beginning of global recognition and cementing his position among the most influential designers of the decade.',credit:'Neiman Marcus Fashion Award ceremony, 1979',img:'https://picsum.photos/seed/a70f/800/1000'}
    ]
  },
  {
    id:'1980s',
    items:[
      {year:'1980',desc:'Richard Gere wears Giorgio Armani in American Gigolo, directed by Paul Schrader. The film transforms the public perception of menswear and establishes a new relationship between fashion and cinema that will define the decade.',credit:'Richard Gere in American Gigolo, Paramount Pictures, 1980',img:'https://picsum.photos/seed/a80a/800/1000'},
      {year:'1982',desc:'Giorgio Armani appears on the cover of TIME magazine, the first fashion designer to receive the honor since Christian Dior in 1957. The headline reads \u201CGiorgio\u2019s Gorgeous Style.\u201D',credit:'TIME Magazine cover, April 5, 1982. Photo: Copyright TIME Inc.',img:'https://picsum.photos/seed/a80b/800/1000'},
      {year:'1983',desc:'The Emporio Armani line is launched, offering a younger and more accessible interpretation of the Armani aesthetic. The eagle logo becomes an icon of aspirational urban style.',credit:'Emporio Armani launch campaign, 1983',img:'https://picsum.photos/seed/a80c/800/1000'},
      {year:'1985',desc:'Armani dresses numerous Hollywood stars for the Academy Awards ceremony, establishing a tradition that will continue for decades. The red carpet becomes a natural extension of the brand\u2019s cinematic identity.',credit:'Academy Awards ceremony, Hollywood, 1985',img:'https://picsum.photos/seed/a80d/800/1000'},
      {year:'1986',desc:'A/X Armani Exchange debuts, bringing the Armani name to the contemporary casual market. The move demonstrates a vision of fashion as a democratic language accessible to all.',credit:'A/X Armani Exchange flagship opening, 1986',img:'https://picsum.photos/seed/a80e/800/1000'},
      {year:'1989',desc:'Giorgio Armani opens a flagship store on Madison Avenue, New York. The minimalist interior by Claudio Silvestrin reflects the same reductive elegance found in every garment.',credit:'Madison Avenue flagship store, New York, 1989',img:'https://picsum.photos/seed/a80f/800/1000'}
    ]
  },
  {
    id:'1990s',
    items:[
      {year:'1990',desc:'With Giorgio Armani: Images of Man, Richard Martin and Harold Koda analyze the first fifteen years of Armani menswear, codifying its aesthetics and cultural impact. The Armani man emerges as a fluid, performative figure, suspended between rigor and sensuality. Essential silhouettes, measured gestures, and a constant dialogue with image: volume becomes a key tool to understand how Armani\u2019s style redefines male identity in the contemporary era.',credit:'Cover of the book Images of men, published by Rizzoli',img:'https://picsum.photos/seed/a90a/800/1000'},
      {year:'1992',desc:'The Armani brand expands into home furnishings with Armani Casa, translating the design philosophy of understated elegance from the wardrobe to the living space.',credit:'Armani Casa collection launch, Milan, 1992',img:'https://picsum.photos/seed/a90b/800/1000'},
      {year:'1994',desc:'A major exhibition at the Royal Academy of Arts in London celebrates the Armani vision. The cultural world recognizes fashion as a form of artistic expression.',credit:'Exhibition at the Royal Academy of Arts, London, 1994',img:'https://picsum.photos/seed/a90c/800/1000'},
      {year:'1996',desc:'Armani designs costumes for the film adaptation of The English Patient. The collaboration between fashion and cinema deepens, reinforcing the idea that clothing tells a story.',credit:'The English Patient, Miramax Films, 1996',img:'https://picsum.photos/seed/a90d/800/1000'},
      {year:'1997',desc:'Giorgio Armani receives the Council of Fashion Designers of America International Award, recognizing his enduring influence on global fashion and his role in shaping modern menswear.',credit:'CFDA International Award ceremony, New York, 1997',img:'https://picsum.photos/seed/a90e/800/1000'},
      {year:'1999',desc:'The brand consolidates its global presence with stores across major capitals. From Tokyo to Paris, the Armani universe offers a coherent vision of style across cultures.',credit:'Armani global store network, 1999',img:'https://picsum.photos/seed/a90f/800/1000'}
    ]
  },
  {
    id:'2000s',
    items:[
      {year:'2000',desc:'The Guggenheim Museum in New York dedicates a major retrospective to Giorgio Armani, curated by Harold Koda and Germano Celant. It is the first time a living designer is honored by the institution. Conceived to travel the world, the exhibition narrates the Armani universe through themes and forms, showcasing the architectural essentialism of his lines and the timeless vision that defines each of his creations.',credit:'Opening of Giorgio Armani: A Retrospective at Guggenheim Museum in New York, United States, on October 19, 2000. Photo: David LEFRANC/Gamma-Rapho via Getty Images',img:'https://picsum.photos/seed/a00a/800/1000'},
      {year:'2001',desc:'Armani Teatro opens in Milan on Via Borgonuovo. The former Nestl\u00E9 factory is transformed into a multifunctional space for fashion shows, events, and cultural exhibitions.',credit:'Armani Teatro inauguration, Milan, 2001',img:'https://picsum.photos/seed/a00b/800/1000'},
      {year:'2003',desc:'The Armani Group expands into hospitality and luxury living. The announcement of the first Armani Hotel signals a new frontier in total lifestyle design.',credit:'Armani Hotel project announcement, 2003',img:'https://picsum.photos/seed/a00c/800/1000'},
      {year:'2004',desc:'Giorgio Armani celebrates 30 years of the brand with a landmark exhibition in Rome. Three decades of innovation are presented as a continuous thread of creative coherence.',credit:'30th anniversary exhibition, Rome, 2004',img:'https://picsum.photos/seed/a00d/800/1000'},
      {year:'2005',desc:'A new flagship store opens in the Ginza district of Tokyo, designed by Doriana and Massimiliano Fuksas. The building\u2019s undulating facade becomes an architectural landmark.',credit:'Armani Ginza Tower, Tokyo, 2005. Architecture by Fuksas',img:'https://picsum.photos/seed/a00e/800/1000'},
      {year:'2007',desc:'Armani Priv\u00E9 nightclub opens in Milan, extending the brand\u2019s presence into nightlife and social culture. The space embodies the same refined atmosphere found across all Armani environments.',credit:'Armani Priv\u00E9 nightclub, Milan, 2007',img:'https://picsum.photos/seed/a00f/800/1000'},
      {year:'2009',desc:'The Armani Group consolidates its global structure, unifying all brand lines under a coherent corporate vision that spans fashion, design, hospitality, and lifestyle.',credit:'Armani corporate headquarters, Milan, 2009',img:'https://picsum.photos/seed/a00g/800/1000'}
    ]
  },
  {
    id:'2010s',
    items:[
      {year:'2010',desc:'The Armani Hotel Dubai opens inside the Burj Khalifa, the tallest building in the world. The interiors reflect the same minimalist elegance that defines every Armani creation, extending the design philosophy to hospitality.',credit:'Armani Hotel Dubai, Burj Khalifa, 2010',img:'https://picsum.photos/seed/a10a/800/1000'},
      {year:'2011',desc:'The Spring/Summer 2011 collection, titled La Femme Bleue, is built around an obsession with blue\u2014an absolute color: matte, luminous, iridescent, transparent. Drawing inspiration from the Tuareg\u2014the "blue men" of the desert\u2014Armani translates this visual and cultural reference into a feminine code, revealing a figure that is both hieratic and contemporary, essential yet powerful.',credit:'Catwalk finale of the Spring\u2013Summer 2011 Womenswear collection. Photography by David McKnight-Peterson. Models: Emiliano Ottavi and Magdalena Frackowiak',img:'https://picsum.photos/seed/a10b/800/1000'},
      {year:'2013',desc:'Giorgio Armani receives the Lifetime Achievement Award from the British Fashion Council in London. The honor recognizes four decades of influence on global fashion.',credit:'BFC Lifetime Achievement Award, London, 2013',img:'https://picsum.photos/seed/a10c/800/1000'},
      {year:'2015',desc:'Armani celebrates 40 years with a major exhibition at the Armani/Silos museum in Milan. The converted 1950s granary becomes a permanent home for the brand\u2019s creative archive.',credit:'Armani/Silos museum opening, Milan, 2015',img:'https://picsum.photos/seed/a10d/800/1000'},
      {year:'2016',desc:'The brand continues to evolve its digital presence, embracing new platforms while maintaining the timeless quality that has defined the Armani aesthetic from the beginning.',credit:'Armani digital campaign, 2016',img:'https://picsum.photos/seed/a10e/800/1000'},
      {year:'2019',desc:'Giorgio Armani announces a commitment to sustainability, pledging to eliminate fur from all collections. The decision reflects a vision of fashion that looks toward the future while honoring its principles.',credit:'Armani sustainability announcement, Milan, 2019',img:'https://picsum.photos/seed/a10f/800/1000'}
    ]
  },
  {
    id:'2020s',
    items:[
      {year:'2020',desc:'In response to the global pandemic, Giorgio Armani presents his collection in an empty theater, live-streamed without an audience. The moment redefines the fashion show as an intimate act of creative expression.',credit:'Armani show during the pandemic, Milan Fashion Week, 2020',img:'https://picsum.photos/seed/a20a/800/1000'},
      {year:'2021',desc:'Armani launches the \u201CGiorgio Armani per Amore\u201D initiative, a philanthropic project supporting communities affected by the global health crisis. Fashion becomes a vehicle for social responsibility.',credit:'Giorgio Armani per Amore initiative, 2021',img:'https://picsum.photos/seed/a20b/800/1000'},
      {year:'2023',desc:'The Armani archive continues to expand as a living testament to half a century of design. New exhibitions and retrospectives invite audiences to explore the enduring relevance of the Armani vision.',credit:'Armani retrospective exhibition, 2023',img:'https://picsum.photos/seed/a20c/800/1000'}
    ]
  }
];

var MODES = ['light','dark','system'];

var state = {
  currentDecade:0,
  currentItem:0,
  dropdownOpen:false,
  modeOpen:false,
  mobileMenuOpen:false,
  visibleDecade:0,
  themeMode:'light'
};

function thumbUrl(decadeIdx,itemIdx){
  return 'https://picsum.photos/seed/t'+decadeIdx+'-'+itemIdx+'/400/500';
}

function applyTheme(mode){
  state.themeMode=mode;
  var body=document.body;

  if(mode==='dark'){
    body.classList.add('dark');
  } else if(mode==='system'){
    var prefersDark=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;
    if(prefersDark){
      body.classList.add('dark');
    } else {
      body.classList.remove('dark');
    }
  } else {
    body.classList.remove('dark');
  }

  updateModeDropdown();
}

function updateModeDropdown(){
  var options=document.querySelectorAll('.mode-option');
  options.forEach(function(opt){
    if(opt.getAttribute('data-mode')===state.themeMode){
      opt.classList.add('active');
    } else {
      opt.classList.remove('active');
    }
  });
}

function renderModeDropdown(){
  var el=document.getElementById('modeDropdown');
  var html='';
  MODES.forEach(function(m){
    html+='<div class="mode-option'+(m===state.themeMode?' active':'')+'" data-mode="'+m+'">'+m+'</div>';
  });
  el.innerHTML=html;
  el.querySelectorAll('.mode-option').forEach(function(opt){
    opt.addEventListener('click',function(e){
      e.stopPropagation();
      var mode=this.getAttribute('data-mode');
      applyTheme(mode);
      state.modeOpen=false;
      document.getElementById('modeBtn').className='mode-btn';
      document.getElementById('modeDropdown').className='mode-dropdown';
    });
  });
}

function renderDecadeDropdown(){
  var el=document.getElementById('decadeDropdown');
  var html='';
  DECADES.forEach(function(d,i){
    html+='<div class="decade-option'+(i===state.currentDecade?' active':'')+'" data-idx="'+i+'">'+d.id+'</div>';
  });
  el.innerHTML=html;
  el.querySelectorAll('.decade-option').forEach(function(opt){
    opt.addEventListener('click',function(){
      state.currentDecade=parseInt(this.getAttribute('data-idx'));
      state.currentItem=0;
      state.dropdownOpen=false;
      render();
      scrollToDecadeSection(state.currentDecade);
    });
  });
}

function scrollToDecadeSection(idx){
  var section=document.querySelector('[data-decade-section="'+idx+'"]');
  if(section){
    var stickyHeight=document.getElementById('decadeHeaderSticky').offsetHeight;
    var container=document.getElementById('pageBody');
    var offset;
    if(window.innerWidth>768){
      offset=section.offsetTop-stickyHeight;
      container.scrollTo({top:offset,behavior:'smooth'});
    } else {
      offset=section.getBoundingClientRect().top+window.scrollY-stickyHeight-60;
      window.scrollTo({top:offset,behavior:'smooth'});
    }
  }
}

function renderThumbnails(){
  var area=document.getElementById('thumbsArea');
  var html='';
  DECADES.forEach(function(d,di){
    html+='<div class="decade-section" data-decade-section="'+di+'">';
    html+='<div class="decade-section-label">'+d.id+'</div>';
    html+='<div class="thumb-grid">';
    d.items.forEach(function(item,ii){
      var active=(di===state.currentDecade&&ii===state.currentItem)?' active':'';
      html+='<div class="thumb-cell'+active+'" data-d="'+di+'" data-i="'+ii+'">';
      html+='<img src="'+thumbUrl(di,ii)+'" alt="'+d.id+' - '+item.year+'" loading="lazy">';
      html+='</div>';
    });
    html+='</div></div>';
  });
  area.innerHTML=html;
  area.querySelectorAll('.thumb-cell').forEach(function(cell){
    cell.addEventListener('click',function(){
      var di=parseInt(this.getAttribute('data-d'));
      var ii=parseInt(this.getAttribute('data-i'));
      state.currentDecade=di;
      state.currentItem=ii;
      if(window.innerWidth<=768){
        showMobileDetail(di,ii);
      } else {
        updateActiveThumb();
        renderDetail();
      }
    });
  });
}

function updateActiveThumb(){
  document.querySelectorAll('.thumb-cell').forEach(function(cell){
    var di=parseInt(cell.getAttribute('data-d'));
    var ii=parseInt(cell.getAttribute('data-i'));
    if(di===state.currentDecade&&ii===state.currentItem){
      cell.classList.add('active');
    } else {
      cell.classList.remove('active');
    }
  });
}

function renderDetail(){
  var d=DECADES[state.currentDecade];
  var item=d.items[state.currentItem];
  document.getElementById('detailYear').textContent=item.year;
  document.getElementById('detailDesc').textContent=item.desc;
  document.getElementById('detailCredit').textContent=item.credit;
  document.getElementById('featuredImg').src=item.img;
  document.getElementById('featuredImg').alt=d.id+' - '+item.year;
}

function updateStickyDecadeTitle(){
  var sections=document.querySelectorAll('[data-decade-section]');
  var stickyEl=document.getElementById('decadeHeaderSticky');
  var stickyBottom=stickyEl.getBoundingClientRect().bottom;

  var currentVisibleIdx=0;
  sections.forEach(function(section){
    var rect=section.getBoundingClientRect();
    if(rect.top<stickyBottom+50){
      currentVisibleIdx=parseInt(section.getAttribute('data-decade-section'));
    }
  });

  if(currentVisibleIdx!==state.visibleDecade){
    state.visibleDecade=currentVisibleIdx;
    document.getElementById('decadeTitle').textContent=DECADES[currentVisibleIdx].id;
  }
}

function render(){
  document.getElementById('decadeTitle').textContent=DECADES[state.currentDecade].id;
  state.visibleDecade=state.currentDecade;

  var toggleEl=document.getElementById('decadeToggle');
  toggleEl.className='decade-toggle'+(state.dropdownOpen?' open':'');

  var ddEl=document.getElementById('decadeDropdown');
  ddEl.className='decade-dropdown'+(state.dropdownOpen?' open':'');

  var modeBtnEl=document.getElementById('modeBtn');
  modeBtnEl.className='mode-btn'+(state.modeOpen?' open':'');

  var modeDdEl=document.getElementById('modeDropdown');
  modeDdEl.className='mode-dropdown'+(state.modeOpen?' open':'');

  renderDecadeDropdown();
  renderModeDropdown();
  renderThumbnails();
  renderDetail();
}

function showMobileDetail(di,ii){
  var d=DECADES[di];
  var item=d.items[ii];
  var body=document.getElementById('mobileDetailBody');
  body.innerHTML='<img src="'+item.img+'" alt="'+d.id+' - '+item.year+'">'
    +'<div class="detail-year">'+item.year+'</div>'
    +'<div class="detail-desc">'+item.desc+'</div>'
    +'<div class="detail-credit">'+item.credit+'</div>';
  document.getElementById('mobileDetail').classList.add('open');
  document.body.style.overflow='hidden';
}

function closeMobileDetail(){
  document.getElementById('mobileDetail').classList.remove('open');
  document.body.style.overflow='';
}

function initSearch(){
  var link=document.getElementById('searchLink');
  var input=document.getElementById('searchInput');
  var wrap=document.getElementById('searchWrap');

  link.addEventListener('click',function(e){
    e.stopPropagation();
    link.classList.add('hidden');
    input.classList.add('active');
    input.focus();
  });

  input.addEventListener('click',function(e){
    e.stopPropagation();
  });

  document.addEventListener('click',function(e){
    if(!wrap.contains(e.target)&&input.classList.contains('active')){
      input.classList.remove('active');
      link.classList.remove('hidden');
      input.value='';
    }
  });
}

function init(){
  render();
  initSearch();
  applyTheme('light');

  if(window.matchMedia){
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',function(){
      if(state.themeMode==='system'){
        applyTheme('system');
      }
    });
  }

  var scrollTarget=document.getElementById('pageBody');

  function onScroll(){
    updateStickyDecadeTitle();
  }

  if(window.innerWidth>768){
    scrollTarget.addEventListener('scroll',onScroll,{passive:true});
  } else {
    window.addEventListener('scroll',onScroll,{passive:true});
  }

  window.addEventListener('resize',function(){
    scrollTarget.removeEventListener('scroll',onScroll);
    window.removeEventListener('scroll',onScroll);
    if(window.innerWidth>768){
      scrollTarget.addEventListener('scroll',onScroll,{passive:true});
    } else {
      window.addEventListener('scroll',onScroll,{passive:true});
    }
  });

  document.getElementById('decadeToggle').addEventListener('click',function(){
    state.dropdownOpen=!state.dropdownOpen;
    state.modeOpen=false;
    render();
  });

  document.getElementById('modeBtn').addEventListener('click',function(e){
    e.stopPropagation();
    state.modeOpen=!state.modeOpen;
    state.dropdownOpen=false;
    render();
  });

  document.getElementById('hamburgerBtn').addEventListener('click',function(){
    document.getElementById('mobileMenu').classList.add('open');
    document.body.style.overflow='hidden';
  });

  document.getElementById('mobileMenuClose').addEventListener('click',function(){
    document.getElementById('mobileMenu').classList.remove('open');
    document.body.style.overflow='';
  });

  document.getElementById('mobileDetailBack').addEventListener('click',closeMobileDetail);

  var eyeContainer=document.getElementById('logoEye');
  if(eyeContainer){
    createEyeLogo(eyeContainer,68);
  }

  /* ── Logo brand morph animation ── */
  (function(){
    var text1=document.getElementById('morphText1');
    var text2=document.getElementById('morphText2');
    var header=document.getElementById('siteHeader');
    if(!text1||!text2||!header) return;

    var morphTime=1.2;
    var morph=0;
    var time=Date.now();
    var animating=false;
    var rafId=null;
    var revealing=false;

    // Start hidden: text1=" " fully visible, text2="Publiceye" fully hidden
    text1.textContent='\u00A0';
    text2.textContent='Publiceye';
    text1.style.opacity='100%';
    text1.style.filter='blur(0px)';
    text2.style.opacity='0%';
    text2.style.filter='blur(100px)';

    function setMorph(fraction){
      // fraction goes from 0 (start) to 1 (done)
      // text1 = the "from" text fading out
      // text2 = the "to" text fading in
      var fClamp=Math.max(fraction,0.001);
      var inv=Math.max(1-fraction,0.001);

      text2.style.filter='blur('+Math.min(8/fClamp-8,100)+'px)';
      text2.style.opacity=String(Math.pow(fClamp,0.4)*100)+'%';

      text1.style.filter='blur('+Math.min(8/inv-8,100)+'px)';
      text1.style.opacity=String(Math.pow(inv,0.4)*100)+'%';
    }

    function finishMorph(){
      text2.style.filter='blur(0px)';
      text2.style.opacity='100%';
      text1.style.filter='blur(100px)';
      text1.style.opacity='0%';
    }

    function animate(){
      if(!animating) return;
      rafId=requestAnimationFrame(animate);

      var now=Date.now();
      var dt=(now-time)/1000;
      time=now;

      morph+=dt;
      var fraction=morph/morphTime;

      if(fraction>=1){
        finishMorph();
        animating=false;
        if(rafId){ cancelAnimationFrame(rafId); rafId=null; }
        return;
      }

      setMorph(fraction);
    }

    function startMorph(reveal){
      // If already going the same direction, let it continue
      if(reveal===revealing&&animating) return;
      // If already at the target state and not animating, skip
      if(reveal===revealing&&!animating) return;

      revealing=reveal;

      if(reveal){
        text1.textContent='\u00A0';
        text2.textContent='Publiceye';
      } else {
        text1.textContent='Publiceye';
        text2.textContent='\u00A0';
      }

      // Start: text1 fully visible, text2 fully hidden
      text1.style.opacity='100%';
      text1.style.filter='blur(0px)';
      text2.style.opacity='0%';
      text2.style.filter='blur(100px)';

      morph=0;
      time=Date.now();
      animating=true;

      if(rafId){ cancelAnimationFrame(rafId); rafId=null; }
      rafId=requestAnimationFrame(animate);
    }

    header.addEventListener('mouseenter',function(){
      startMorph(true);
    });

    header.addEventListener('mouseleave',function(){
      startMorph(false);
    });
  })();
  /* ── End logo brand morph ── */

  document.addEventListener('click',function(e){
    if(!e.target.closest('.mode-wrap')){
      state.modeOpen=false;
      document.getElementById('modeBtn').className='mode-btn';
      document.getElementById('modeDropdown').className='mode-dropdown';
    }
    if(!e.target.closest('.decade-header')&&!e.target.closest('.decade-dropdown')){
      state.dropdownOpen=false;
      document.getElementById('decadeToggle').className='decade-toggle';
      document.getElementById('decadeDropdown').className='decade-dropdown';
    }
  });
}

document.addEventListener('DOMContentLoaded',init);
